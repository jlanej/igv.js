<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>IGV Variant Review</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>üß¨ IGV De Novo Variant Review</h1>
        <div id="stats-bar">
            <span id="stat-total">‚Äì</span> variants |
            <span id="stat-filtered">‚Äì</span> shown |
            <span class="curation-pass">‚úì <span id="stat-pass">0</span></span>
            <span class="curation-fail">‚úó <span id="stat-fail">0</span></span>
            <span class="curation-uncertain">? <span id="stat-uncertain">0</span></span>
            <span class="curation-pending">‚óã <span id="stat-pending">0</span></span>
        </div>
    </header>

    <div id="app">
        <!-- Sidebar collapse toggle -->
        <button id="btn-collapse-sidebar" class="btn btn-sm" title="Toggle filter sidebar (Ctrl+B)">‚óÄ</button>

        <!-- Filter sidebar -->
        <aside id="filter-panel">
            <div class="filter-heading">
                <h2>Filters</h2>
                <button id="btn-toggle-all-filters" class="btn btn-sm" title="Collapse/expand all filters" aria-expanded="true">‚ñº Collapse All</button>
            </div>
            <div id="filter-controls"></div>
            <div class="filter-actions">
                <button id="btn-apply-filters" class="btn btn-primary">Apply Filters</button>
                <button id="btn-clear-filters" class="btn">Clear All</button>
            </div>
            <div class="filter-actions">
                <button id="btn-save-filters" class="btn btn-sm">üíæ Save Filters</button>
                <button id="btn-load-filters" class="btn btn-sm">üìÇ Load Filters</button>
            </div>
            <hr>
            <h2>Quick Curation</h2>
            <p class="hint">Apply to all selected variants:</p>
            <div class="curation-buttons">
                <button class="btn curation-pass" data-status="pass">‚úì Pass</button>
                <button class="btn curation-fail" data-status="fail">‚úó Fail</button>
                <button class="btn curation-uncertain" data-status="uncertain">? Uncertain</button>
                <button class="btn" data-status="pending">‚óã Reset</button>
            </div>
            <hr>
            <h2>Export</h2>
            <button id="btn-export" class="btn">üì• Export TSV</button>
            <button id="btn-export-xlsx" class="btn btn-primary">üìä Export XLSX</button>
            <div id="xlsx-progress" style="display:none;">
                <div class="progress-bar"><div class="progress-fill" id="xlsx-progress-fill"></div></div>
                <span id="xlsx-progress-text">Preparing‚Ä¶</span>
            </div>
        </aside>

        <!-- Main content -->
        <main>
            <!-- Tabs -->
            <div id="tabs">
                <button class="tab active" data-tab="variants">Variant Table</button>
                <button class="tab" data-tab="summary">Gene Summary</button>
                <button class="tab" data-tab="sample-summary">Sample Summary</button>
                <button class="tab" data-tab="sample-qc" id="tab-btn-sample-qc" style="display:none;">Sample QC</button>
            </div>

            <!-- Variant table tab -->
            <div id="tab-variants" class="tab-content active">
                <div class="table-controls">
                    <label><input type="checkbox" id="select-all"> Select all on page</label>
                    <div class="variant-search-wrap">
                        <input type="text" id="variant-search" placeholder="Search variants‚Ä¶" aria-label="Search variants">
                        <button id="variant-search-clear" class="btn btn-sm" title="Clear search">‚úï</button>
                    </div>
                    <span id="page-info"></span>
                    <div class="pagination">
                        <button id="btn-prev" class="btn btn-sm" disabled>‚Üê Prev</button>
                        <button id="btn-next" class="btn btn-sm" disabled>Next ‚Üí</button>
                    </div>
                </div>
                <div id="variant-table-wrap">
                    <table id="variant-table">
                        <thead><tr id="table-header"></tr></thead>
                        <tbody id="table-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- Gene summary tab -->
            <div id="tab-summary" class="tab-content">
                <div id="summary-info"></div>
                <div id="summary-table-wrap">
                    <table id="summary-table">
                        <thead>
                            <tr>
                                <th>Gene</th>
                                <th>Total</th>
                                <th>Samples</th>
                                <th>Pass</th>
                                <th>Fail</th>
                                <th>Uncertain</th>
                                <th>Pending</th>
                                <th>Variants</th>
                                <th>Flag Gene</th>
                            </tr>
                        </thead>
                        <tbody id="summary-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- Sample summary tab -->
            <div id="tab-sample-summary" class="tab-content">
                <div id="sample-summary-info"></div>
                <h4>Cohort Summary</h4>
                <div id="cohort-summary-table-wrap">
                    <table id="cohort-summary-table">
                        <thead><tr id="cohort-summary-header"></tr></thead>
                        <tbody id="cohort-summary-body"></tbody>
                    </table>
                </div>
                <h4>Per-Sample Counts</h4>
                <div id="sample-summary-table-wrap">
                    <table id="sample-summary-table">
                        <thead><tr id="sample-summary-header"></tr></thead>
                        <tbody id="sample-summary-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- Sample QC tab -->
            <div id="tab-sample-qc" class="tab-content">
                <div id="sample-qc-info"></div>
                <div id="sample-qc-table-wrap">
                    <table id="sample-qc-table">
                        <thead><tr id="sample-qc-header"></tr></thead>
                        <tbody id="sample-qc-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- Resize handle for variant table -->
            <div id="table-resize-handle" title="Drag to resize table"></div>

            <!-- IGV viewer -->
            <div id="igv-section">
                <div id="igv-header">
                    <h2 id="igv-title">Select a variant to view alignments</h2>
                    <div id="igv-controls">
                        <label class="display-mode-label" for="display-mode-select">Display:</label>
                        <select id="display-mode-select" class="btn btn-sm" title="Set track display mode for all alignment tracks">
                            <option value="SQUISHED" selected>Squished</option>
                            <option value="EXPANDED">Expanded</option>
                            <option value="COLLAPSED">Collapsed</option>
                        </select>
                    </div>
                    <div id="igv-curation" style="display:none;">
                        <button class="btn curation-pass" data-status="pass">‚úì Pass</button>
                        <button class="btn curation-fail" data-status="fail">‚úó Fail</button>
                        <button class="btn curation-uncertain" data-status="uncertain">? Uncertain</button>
                        <select id="note-suggestions" class="btn btn-sm" title="Insert a previously used note" aria-label="Previous curation notes">
                            <option value="">Previous notes‚Ä¶</option>
                        </select>
                        <textarea id="curation-note" placeholder="Curation note‚Ä¶" rows="1"></textarea>
                        <button id="btn-save-note" class="btn btn-sm">Save Note</button>
                    </div>
                </div>
                <div id="igv-div"></div>
                <div id="track-load-status"></div>
            </div>
        </main>
    </div>

    <!-- Keyboard shortcuts help -->
    <button id="shortcuts-toggle" title="Keyboard shortcuts (?)">?</button>
    <div id="shortcuts-panel">
        <h3>Keyboard Shortcuts</h3>
        <div class="shortcut-row"><span>Next uncurated variant</span> <span><kbd>j</kbd> or <kbd>‚Üì</kbd></span></div>
        <div class="shortcut-row"><span>Prev uncurated variant</span> <span><kbd>k</kbd> or <kbd>‚Üë</kbd></span></div>
        <div class="shortcut-row"><span>Mark as Pass</span> <kbd>p</kbd></div>
        <div class="shortcut-row"><span>Mark as Fail</span> <kbd>f</kbd></div>
        <div class="shortcut-row"><span>Mark as Uncertain</span> <kbd>u</kbd></div>
        <div class="shortcut-row"><span>Pass &amp; advance</span> <kbd>P</kbd></div>
        <div class="shortcut-row"><span>Fail &amp; advance</span> <kbd>F</kbd></div>
        <div class="shortcut-row"><span>Uncertain &amp; advance</span> <kbd>U</kbd></div>
        <div class="shortcut-row"><span>Toggle shortcuts</span> <kbd>?</kbd></div>
        <div class="shortcut-row"><span>Toggle sidebar</span> <kbd>Ctrl+B</kbd></div>
    </div>

    <script src="app.js"></script>
</body>
</html>
